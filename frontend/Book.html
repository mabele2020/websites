<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Booking | Turkuaz Beach Hotel</title>
  <link rel="stylesheet" href="bootstrap-5.3.7/dist/css/bootstrap.min.css" />
</head>
<body>
  <div class="container py-4">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2 class="text-primary m-0">üõéÔ∏è Book Your Stay</h2>
      <a href="index.html" class="btn btn-warning">Logout</a>
    </div>

    <p class="text-center text-muted mb-3">
      Fill in the details below to reserve your room and enjoy a relaxing getaway.
    </p>

    <!-- Feedback Message -->
    <div id="messageBox" class="alert d-none text-center" role="alert"></div>

    <!-- Booking Form -->
    <form id="bookingForm" class="row g-3 needs-validation" novalidate>
      <div class="col-md-6">
        <label for="name" class="form-label">Full Name</label>
        <input type="text" class="form-control" id="name" required />
      </div>

      <div class="col-md-6">
        <label for="email" class="form-label">Email Address</label>
        <input type="email" class="form-control" id="email" required />
      </div>

      <div class="col-md-6">
        <label for="password" class="form-label">Password</label>
        <input type="password" class="form-control" id="password" required />
      </div>

      <div class="col-md-6">
        <label for="address" class="form-label">Street Address</label>
        <input type="text" class="form-control" id="address" required />
      </div>

      <div class="col-md-4">
        <label for="city" class="form-label">City</label>
        <input type="text" class="form-control" id="city" required />
      </div>

      <div class="col-md-4">
        <label for="state" class="form-label">State</label>
        <select id="state" class="form-select" required>
          <option selected disabled value="">Choose...</option>
          <option>Zanzibar</option>
          <option>Dar es Salaam</option>
          <option>Arusha</option>
        </select>
      </div>

      <div class="col-md-4">
        <label for="zip" class="form-label">Zip Code</label>
        <input type="text" class="form-control" id="zip" required />
      </div>

      <div class="col-md-6">
        <label for="checkinDate" class="form-label">Check-in Date</label>
        <input type="date" class="form-control" id="checkinDate" required />
      </div>

      <div class="col-md-6">
        <label for="checkoutDate" class="form-label">Check-out Date</label>
        <input type="date" class="form-control" id="checkoutDate" required />
      </div>

      <div class="col-md-6">
        <label for="roomType" class="form-label">Room Type (USD)</label>
        <select id="roomType" class="form-select" required>
          <option selected disabled value="">Choose a room...</option>
          <option value="Standard Room ‚Äì $80/night">Standard Room ‚Äì $80/night</option>
          <option value="Deluxe Room ‚Äì $120/night">Deluxe Room ‚Äì $120/night</option>
          <option value="Ocean View Room ‚Äì $150/night">Ocean View Room ‚Äì $150/night</option>
          <option value="Honeymoon Suite ‚Äì $200/night">Honeymoon Suite ‚Äì $200/night</option>
        </select>
      </div>

      <div class="col-md-6">
        <label for="guests" class="form-label">Number of Guests</label>
        <input type="number" class="form-control" id="guests" min="1" max="10" required />
      </div>

      <div class="col-12">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="terms" required />
          <label class="form-check-label" for="terms">
            I agree to the terms and conditions.
          </label>
        </div>
      </div>

      <div class="col-12 text-center">
        <button type="submit" class="btn btn-success px-5">Confirm Booking</button>
      </div>

      <div class="col-12 text-center mt-3">
        <button type="button" id="viewBookingsBtn" class="btn btn-info px-4">View My Bookings</button>
      </div>
    </form>
  </div>

  <script src="bootstrap-5.3.7/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // ‚úÖ Auto-fill room from query param
    const urlParams = new URLSearchParams(window.location.search);
    const selectedRoom = urlParams.get("room");
    if (selectedRoom) {
      document.getElementById("roomType").value = selectedRoom;
    }

    // ‚úÖ Form submission
    document.getElementById("bookingForm").addEventListener("submit", async function (e) {
      e.preventDefault();

      const bookingData = {
        name: document.getElementById("name").value,
        email: document.getElementById("email").value,
        password: document.getElementById("password").value,
        address: document.getElementById("address").value,
        city: document.getElementById("city").value,
        state: document.getElementById("state").value,
        zip: document.getElementById("zip").value,
        checkinDate: document.getElementById("checkinDate").value,
        checkoutDate: document.getElementById("checkoutDate").value,
        roomType: document.getElementById("roomType").value,
        guests: document.getElementById("guests").value
      };

      try {
        const response = await fetch("http://localhost:8080/api/bookings", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(bookingData)
        });

        if (!response.ok) {
          const errorText = await response.text();
          throw new Error(errorText || "Booking failed.");
        }

        const savedBooking = await response.json();
        localStorage.setItem("userEmail", bookingData.email);
        showMessage("Booking successful! üéâ", "success");

        document.getElementById("bookingForm").reset();
        setTimeout(() => document.getElementById("messageBox").classList.add("d-none"), 5000);
      } catch (err) {
        showMessage("Error: " + err.message, "danger");
        setTimeout(() => document.getElementById("messageBox").classList.add("d-none"), 5000);
      }
    });

    // ‚úÖ Show message
    function showMessage(message, type) {
      const box = document.getElementById("messageBox");
      box.className = `alert alert-${type} text-center`;
      box.textContent = message;
      box.classList.remove("d-none");
    }

    // ‚úÖ View bookings redirect
    document.getElementById("viewBookingsBtn").addEventListener("click", () => {
      window.location.href = "view-bookings.html";
    });
  </script>
</body>
</html>
